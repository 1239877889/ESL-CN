# 交叉验证

| 原文   | [The Elements of Statistical Learning](../book/The Elements of Statistical Learning.pdf) |
| ---- | ---------------------------------------- |
| 翻译   | szcf-weiya                               |
| 时间   | 2017-02-17                               |

用来估计预测误差的最简单的并且最广泛使用的方法大概是交叉验证。这个方法直接估计额外样本误差期望值$Err=E[L(Y,\hat f(X))]$，当方法$\hat f(X)$应用到与$X$和 $Y$联合分布独立的测试样本中该值是广义误差的平均值。正如前面提到的，我们可能希望交叉验证估计当测试集$\cal T$固定时的条件误差。但是正如我们将在7.12节看到的那样，交叉验证一般仅仅对预测误差的期望值有良好的估计。

## K折交叉验证

理论上，如果我们有足够的数据，我们可以设置一个验证集并且用它去评估我们预测模型的好坏。因为数据经常是稀缺的，所有这种方式通常是不可能的。为了巧妙地解决这个问题，$K$折交叉验证采用部分可用数据去拟合模型，然后用不同的部分数据去测试。我们将数据分成$K$个大致相等的部分；举个例子，当$K=5$，情形就像这样：

![](../img/07/pic1.png)

对于第$k$部分（上面的第三个），我们用剩下的$K-1$个部分数据来拟合模型，然后计算预测第$k$部分的数据时模型的预测误差。对$k=1,2,\ldots,K$时做这些工作并且将$K$个预测误差的估计值结合起来。

这里有更多的细节。令$\kappa:\{1,\ldots,N\}\mapsto\{1,\ldots,K\}$是指示函数，它指示了观测值$i$被随机分配到哪的划分。用$\hat f^{-k}(x)$记拟合函数，是利用除掉第$k$部分的数据计算得到的。则预测误差的交叉验证估计为

$$
CV(\hat f)=\frac{1}{N}\sum\limits_{i=1}^NL(y_i,\hat f^{-\kappa (i)}(x_i))\qquad (7.48)
$$

一般地选择$K$为5或10（见下）。$K=N$的情形也称作舍一法交叉验证。在$\kappa(i)=i$的情形中，对于第$i$个观测的拟合是利用不包含第$i$个观测的全部数据进行计算的。

给出一系列模型$f(x,\alpha)$，它是由调整参数$\alpha$来编号的，记$\hat f^{-k}(x,\alpha)$为去除第$k$部分数据的第$\alpha$个模型的拟合。则对于这一系列模型我们定义

$$
CV(\hat f,\alpha)=\frac{1}{N}\sum\limits_{i=1}^NL(y_i,\hat f^{-\kappa (i)}(x_i,\alpha))\qquad (7.49)
$$

函数$CV(\hat f,\alpha)$给出了测试误差曲线的一个估计，而且我们可以找到调整参数$\hat\alpha$使其最小化。我们最终选择的模型是$f(x,\alpha)$，接着我们对所有数据进行拟合。

有趣的是，想知道什么数量的$K$折交叉验证估计。$K=5$或10时，我们可能猜测它估计了期望误差Err，因为每一折的训练集不同于原始训练集。另一方面，如果$K=N$我们可能会猜测交叉验证估计了条件误差$Err_{\cal T}$。结果是交叉验证仅仅有效地估计出平均误差Err，正如将在7.12节讨论的那样。

那我们应该为$K$取什么值呢？$K=N$时，交叉验证估计对于真实（期望的）预测误差近似无偏的，但是可能导致高方差因为$N$个训练集彼此是很相似的。计算量也是很大的，要求应用该学习方法$N$次。在特定的问题中，这个计算可以很快地完成——见练习7.3和5.13。

另一方面，比如$K=5$时，交叉验证有较低的方差。但是偏差便是一个问题了，这取决于当训练集大小变化时学习方法的表现。图7.8显示了在给定任务下某分类器的假定的“学习曲线”，$1-Err$关于训练集大小$N$的曲线。当训练集大小增长到100个观测时分类器的效果不断在改善；当增长到200个观测时改进的效果很小。如果我们的训练集有200个观测，5折交叉验证会估计160个训练样本时分类器的效果，从图7.8可以看到同训练集大小为200时的效果是一样的。因此交叉验证不会有太大的偏差。然而，如果训练集只有50个观测，5折交叉验证会估计40个训练样本时分类器的效果，而且从图中可以看出对$1-Err$会有一个偏低的估计。因此作为$Err$的估计，交叉验证会有上偏。

![](../img/07/fig7.8.png)

> 图7.8. 在给定任务下某分类器假定的学习曲线：$1-Err$关于训练集大小$N$的曲线。含有200个观测的数据集，

总结一下，